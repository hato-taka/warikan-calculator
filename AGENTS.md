# 割り勘アプリ 要件定義

## 1. 目的
- 複数人で発生した支出を公平に分配し、最終的に誰が誰にいくら支払うべきかを明確化する。
- 計算や精算の手間を減らし、参加者がスムーズに割り勘結果を共有できるようにする。

## 2. 前提条件・想定ユーザー
- 飲み会や旅行など、複数人で支出を共有する場面を想定。
- ブラウザベースのWebアプリ。スマートフォン利用を基本とし、レスポンシブ対応でPCアクセスも許容。
- ユーザー登録不要で匿名利用が可能（URL共有ベース）。
- 精算手段は現金を前提。追加開発でPayPay連携を検討。
- 日本円を基本通貨とする（必要に応じて多通貨対応を検討）。

## 3. 用語定義
- 参加者: 割り勘対象のメンバー。
- 立替支出: 参加者が一時的に肩代わりした費用。
- 精算結果: 誰が誰にいくら支払うかをまとめた一覧。

## 4. 機能要件
### 4.1 参加者管理
- 参加者の追加・編集・削除。
- 役割設定（例: 管理者／一般参加者）。

### 4.2 支出管理
- 支出項目の登録（タイトル、金額、支払日、カテゴリ、メモ）。
- どの参加者が立替えたかの記録。
- 支出ごとの負担割合設定（均等割・按分・手入力による割合指定）。
- 支出項目の修正・削除。

### 4.3 精算ロジック
- 各参加者の総支払額と総負担額を算出。
- 不足額／超過額から支払フローを計算し、最小限の送金件数に簡約化。
- 支払結果表示（例: 「A→B: 2,500円」）。
- 端数処理ルール: 100円単位の四捨五入で固定。

### 4.4 表示・共有機能
- 積算状況（参加者ごとの支払額・負担額・差額）の一覧表示。
- 精算結果の共有（URL、PDF、スクリーンショットなど）。
- データのエクスポート／インポート（CSV 等）。

### 4.5 通知・リマインド（任意）
- 精算が確定した際の通知。
- 支払期限リマインド。

## 5. 非機能要件
- **UI/UX**: シンプルで直感的な操作性。スマホ表示最適化。
- **パフォーマンス**: 参加者数や支出件数が多くても計算が即時に完了。
- **セキュリティ**: データ暗号化、アクセス権限管理、個人情報保護。
- **信頼性**: データ永続化、バックアップ、復旧手順。
- **データ保全**: クラウド保存を前提。数日にわたる旅行イベントでも継続利用できるようにする。
- **可用性**: オフライン対応の要否検討。

## 6. データ項目
- 参加者: ID、氏名/ニックネーム、連絡先、役割。
- 支出: ID、タイトル、金額、支払日、カテゴリ、メモ、立替者ID、負担配分。
- 精算結果: 送金元ID、送金先ID、金額、ステータス（未決済／支払済）。

## 7. ユーザーフロー例
1. イベント作成後、参加者を登録。
2. 各支出を登録し、立替者と負担配分を入力。
3. 精算ボタンを押下すると差額が計算され、支払指示が生成。
4. 精算結果を参加者と共有し、支払完了を管理。

## 8. 想定画面
- イベント一覧画面
- 参加者管理画面
- 支出入力画面
- 精算結果画面
- 設定画面（通貨、端数処理、通知設定 等）

## 9. 要件定義で追加で収集すべき情報
- 多通貨対応や為替レート反映の要否。
- 匿名利用時のイベント共有範囲やアクセス制御の詳細。
- PayPay 連携の導入タイミングと必要な機能要件（追加開発前提）。
- バックアップ頻度やデータ保持期間の具体的な運用ルール。


## 10. 技術選定（MVP最小構成）
- **フロントエンド**: Vite + React + TypeScript
  - 理由: 軽量なセットアップでSPAを短期間に構築できる。ビルド時間が短くホットリロードも高速。
- **スタイリング**: Tailwind CSS（必要最低限のユーティリティ）
  - 理由: コンポーネント単位でスピーディにUIを組み立てられる。簡素なデザインであればプレーンCSSにも切り替え可能。
- **状態管理 / データ取得**: ReactローカルState + TanStack Query（遠隔データが増えた場合のみ）
  - 理由: MVPでは画面内の状態のみで十分。将来BaaSと同期する際にTanStack Queryを追加すれば差分取得が容易。
- **バックエンド / BaaS**: Supabase（PostgreSQL + Auth）
  - 理由: サーバー実装を持たずにデータ永続化とシンプルな認証を提供。イベント共有用のRow Level Security設定が可能。
- **ホスティング**: Netlify（フロントエンド） + Supabase（バックエンド/BaaS）
  - 理由: Git連携で自動デプロイが可能。環境変数管理が簡単で、SSLも自動対応。
- **テスト**: Vitest + Testing Library（主要ロジックのみ）
  - 理由: 割り勘計算ロジックなど重要処理の単体テストを軽量に追加。E2EはポストMVP。
- **分析 / 監視**: 初期は省略（必要性が出た際に導入）
  - 理由: MVPではコア機能の実装とフィードバック収集を優先。アクセス状況はNetlify AnalyticsやSupabaseログで暫定確認。

